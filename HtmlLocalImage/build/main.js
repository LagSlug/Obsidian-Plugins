/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";
var __create = Object.create;
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __commonJS = (cb, mod) => function __require() {
  return mod || (0, cb[__getOwnPropNames(cb)[0]])((mod = { exports: {} }).exports, mod), mod.exports;
};
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toESM = (mod, isNodeMode, target) => (target = mod != null ? __create(__getProtoOf(mod)) : {}, __copyProps(
  // If the importer is in node compatibility mode or this is not an ESM
  // file that has been converted to a CommonJS file using a Babel-
  // compatible transform (i.e. "__esModule" has not been set), then set
  // "default" to the CommonJS "module.exports" for node compatibility.
  isNodeMode || !mod || !mod.__esModule ? __defProp(target, "default", { value: mod, enumerable: true }) : target,
  mod
));
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// node_modules/is-url/index.js
var require_is_url = __commonJS({
  "node_modules/is-url/index.js"(exports, module2) {
    module2.exports = isUrl2;
    var protocolAndDomainRE = /^(?:\w+:)?\/\/(\S+)$/;
    var localhostDomainRE = /^localhost[\:?\d]*(?:[^\:?\d]\S*)?$/;
    var nonLocalhostDomainRE = /^[^\s\.]+\.\S{2,}$/;
    function isUrl2(string) {
      if (typeof string !== "string") {
        return false;
      }
      var match = string.match(protocolAndDomainRE);
      if (!match) {
        return false;
      }
      var everythingAfterProtocol = match[1];
      if (!everythingAfterProtocol) {
        return false;
      }
      if (localhostDomainRE.test(everythingAfterProtocol) || nonLocalhostDomainRE.test(everythingAfterProtocol)) {
        return true;
      }
      return false;
    }
  }
});

// src/main.ts
var main_exports = {};
__export(main_exports, {
  default: () => HtmlLocalSrcPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian = require("obsidian");
var import_is_url = __toESM(require_is_url());
var import_path = __toESM(require("path"));
var import_view = require("@codemirror/view");
function getUriPrefix(uri) {
  const index = uri.indexOf("//");
  if (!index)
    return "";
  return uri.substring(0, index + 2);
}
var HtmlLocalSrcPlugin = class extends import_obsidian.Plugin {
  async onload() {
    this.registerEditorExtension(this.getEditorViewPlugin());
    this.registerMarkdownPostProcessor((content) => this.modifyImages(content));
  }
  modifyImages(content) {
    const directoryPath = this.getActiveDirectoryPath(), rootPath = this.getVaultRootPath(), images = this.getImages(content);
    if (!directoryPath || !images.length)
      return;
    images.forEach((img) => {
      const src = img.getAttr("src");
      if (!src) {
        return;
      }
      if ((0, import_is_url.default)(src))
        return;
      if (import_path.default.isAbsolute(src)) {
        const prefix = getUriPrefix(rootPath);
        const pathBody = rootPath.substring(prefix.length);
        img.srcset = prefix + import_path.default.join(pathBody, src);
      } else {
        const prefix = getUriPrefix(directoryPath);
        const pathBody = directoryPath.substring(prefix.length);
        img.srcset = prefix + import_path.default.join(pathBody, src);
      }
    });
  }
  /** returns the active file */
  getActiveFile() {
    return this.app.workspace.getActiveFile();
  }
  /** returns the directory path of the currently active file */
  getActiveDirectoryPath() {
    const activeFile = this.getActiveFile();
    if (!activeFile)
      return null;
    const resourcePath = this.app.vault.getResourcePath(activeFile);
    return resourcePath.substring(0, resourcePath.lastIndexOf("/"));
  }
  getVaultRootPath() {
    const root = this.app.vault.getRoot();
    const rootPath = root.vault.adapter.getResourcePath("");
    return rootPath.substring(0, rootPath.lastIndexOf("?"));
  }
  getImages(element) {
    return Array.from(element.getElementsByTagName("img"));
  }
  getEditorViewPlugin() {
    const plugin = this;
    return import_view.ViewPlugin.fromClass(
      class EditorViewPlugin {
        constructor() {
          this.debouncedUpdate = (0, import_obsidian.debounce)((content) => plugin.modifyImages(content));
        }
        update(update) {
          this.debouncedUpdate(update.view.contentDOM);
        }
      }
    );
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vbm9kZV9tb2R1bGVzL2lzLXVybC9pbmRleC5qcyIsICIuLi9zcmMvbWFpbi50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiXG4vKipcbiAqIEV4cG9zZSBgaXNVcmxgLlxuICovXG5cbm1vZHVsZS5leHBvcnRzID0gaXNVcmw7XG5cbi8qKlxuICogUmVnRXhwcy5cbiAqIEEgVVJMIG11c3QgbWF0Y2ggIzEgYW5kIHRoZW4gYXQgbGVhc3Qgb25lIG9mICMyLyMzLlxuICogVXNlIHR3byBsZXZlbHMgb2YgUkVzIHRvIGF2b2lkIFJFRE9TLlxuICovXG5cbnZhciBwcm90b2NvbEFuZERvbWFpblJFID0gL14oPzpcXHcrOik/XFwvXFwvKFxcUyspJC87XG5cbnZhciBsb2NhbGhvc3REb21haW5SRSA9IC9ebG9jYWxob3N0W1xcOj9cXGRdKig/OlteXFw6P1xcZF1cXFMqKT8kL1xudmFyIG5vbkxvY2FsaG9zdERvbWFpblJFID0gL15bXlxcc1xcLl0rXFwuXFxTezIsfSQvO1xuXG4vKipcbiAqIExvb3NlbHkgdmFsaWRhdGUgYSBVUkwgYHN0cmluZ2AuXG4gKlxuICogQHBhcmFtIHtTdHJpbmd9IHN0cmluZ1xuICogQHJldHVybiB7Qm9vbGVhbn1cbiAqL1xuXG5mdW5jdGlvbiBpc1VybChzdHJpbmcpe1xuICBpZiAodHlwZW9mIHN0cmluZyAhPT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICB2YXIgbWF0Y2ggPSBzdHJpbmcubWF0Y2gocHJvdG9jb2xBbmREb21haW5SRSk7XG4gIGlmICghbWF0Y2gpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICB2YXIgZXZlcnl0aGluZ0FmdGVyUHJvdG9jb2wgPSBtYXRjaFsxXTtcbiAgaWYgKCFldmVyeXRoaW5nQWZ0ZXJQcm90b2NvbCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGlmIChsb2NhbGhvc3REb21haW5SRS50ZXN0KGV2ZXJ5dGhpbmdBZnRlclByb3RvY29sKSB8fFxuICAgICAgbm9uTG9jYWxob3N0RG9tYWluUkUudGVzdChldmVyeXRoaW5nQWZ0ZXJQcm90b2NvbCkpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIHJldHVybiBmYWxzZTtcbn1cbiIsICJpbXBvcnQgeyBQbHVnaW4sIGRlYm91bmNlLCBWaWV3IH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgaXNVcmwgZnJvbSBcImlzLXVybFwiO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBQbHVnaW5WYWx1ZSwgVmlld1BsdWdpbiwgVmlld1VwZGF0ZSB9IGZyb20gXCJAY29kZW1pcnJvci92aWV3XCI7XG5cbi8qKlxuICogXG4gKiBAdG9kbyBjYW4ndCBmaWd1cmUgb3V0IGV4YWN0bHkgd2h5IE9ic2lkaWFuIGlzIGxvYWRpbmcgaW1hZ2VzIGZyb20gXG4gKiAgICAgICBhcHA6Ly9vYnNpZGlhbi5tZC9JbWFnZU5hbWUucG5nIG9uIHRoZSBpbml0aWFsIGxvYWQgb2YgYSBub3RlXG4gKiAgXG4gKi9cblxuZnVuY3Rpb24gZ2V0VXJpUHJlZml4KHVyaTogc3RyaW5nKSB7XG4gIGNvbnN0IGluZGV4ID0gdXJpLmluZGV4T2YoJy8vJyk7XG4gIGlmICghaW5kZXgpIHJldHVybiAnJztcbiAgcmV0dXJuIHVyaS5zdWJzdHJpbmcoMCwgaW5kZXggKyAyKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgSHRtbExvY2FsU3JjUGx1Z2luIGV4dGVuZHMgUGx1Z2luIHtcblxuICBhc3luYyBvbmxvYWQoKSB7XG5cbiAgICB0aGlzLnJlZ2lzdGVyRWRpdG9yRXh0ZW5zaW9uKHRoaXMuZ2V0RWRpdG9yVmlld1BsdWdpbigpKTtcblxuICAgIHRoaXMucmVnaXN0ZXJNYXJrZG93blBvc3RQcm9jZXNzb3IoKGNvbnRlbnQpID0+IHRoaXMubW9kaWZ5SW1hZ2VzKGNvbnRlbnQpKTtcbiAgfVxuXG4gIG1vZGlmeUltYWdlcyhjb250ZW50OiBIVE1MRWxlbWVudCkge1xuXG4gICAgY29uc3QgZGlyZWN0b3J5UGF0aCA9IHRoaXMuZ2V0QWN0aXZlRGlyZWN0b3J5UGF0aCgpLFxuICAgICAgcm9vdFBhdGggPSB0aGlzLmdldFZhdWx0Um9vdFBhdGgoKSxcbiAgICAgIGltYWdlcyA9IHRoaXMuZ2V0SW1hZ2VzKGNvbnRlbnQpO1xuXG5cbiAgICAvLyBoYWx0IHByb2Nlc3NpbmcgaWYgdGhlcmUgYXJlIG5vIGltYWdlcyBvciB0aGVyZSBpc24ndCBhbiBvcGVuIG5vdGVcbiAgICBpZiAoIWRpcmVjdG9yeVBhdGggfHwgIWltYWdlcy5sZW5ndGgpIHJldHVybjtcblxuICAgIC8vIGxvb3AgdGhyb3VnaCBlYWNoIGltYWdlIGFuZCByZXBsYWNlIHRoZSBzcmMgdGFnIHdpdGggb25lIHRoYXQgd29ya3Mgd2l0aGluIHRoZSBhcHBsaWNhdGlvblxuICAgIGltYWdlcy5mb3JFYWNoKGltZyA9PiB7XG4gICAgICBjb25zdCBzcmMgPSBpbWcuZ2V0QXR0cignc3JjJyk7XG5cbiAgICAgIC8vIGltYWdlcyB3aXRob3V0IGFuIHNyYyBhcmUgbm90IG15IHByb2JsZW0uXG4gICAgICBpZiAoIXNyYykge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIGFzc3VtZSB0aGF0IGltYWdlcyB3aXRoIHZhbGlkIFVSSXMgYXJlIGV4dGVybmFsLCBzbyBjYW4gYmUgbGVmdCBhbG9uZS5cbiAgICAgIGlmIChpc1VybChzcmMpKSByZXR1cm47XG5cbiAgICAgIC8vIHRoZSBpbWFnZSBoYXMgYW4gYWJzb2x1dGUgcGF0aFxuICAgICAgaWYgKHBhdGguaXNBYnNvbHV0ZShzcmMpKSB7XG4gICAgICAgIGNvbnN0IHByZWZpeCA9IGdldFVyaVByZWZpeChyb290UGF0aCk7XG4gICAgICAgIGNvbnN0IHBhdGhCb2R5ID0gcm9vdFBhdGguc3Vic3RyaW5nKHByZWZpeC5sZW5ndGgpO1xuICAgICAgICBpbWcuc3Jjc2V0ID0gcHJlZml4ICsgcGF0aC5qb2luKHBhdGhCb2R5LCBzcmMpO1xuICAgICAgfVxuICAgICAgLy8gdGhlIGltYWdlIGhhcyBhIHJlbGF0aXZlIHBhdGhcbiAgICAgIGVsc2Uge1xuICAgICAgICBjb25zdCBwcmVmaXggPSBnZXRVcmlQcmVmaXgoZGlyZWN0b3J5UGF0aCk7XG4gICAgICAgIGNvbnN0IHBhdGhCb2R5ID0gZGlyZWN0b3J5UGF0aC5zdWJzdHJpbmcocHJlZml4Lmxlbmd0aCk7XG4gICAgICAgIGltZy5zcmNzZXQgPSBwcmVmaXggKyBwYXRoLmpvaW4ocGF0aEJvZHksIHNyYyk7XG4gICAgICB9XG5cbiAgICB9KTtcbiAgfVxuXG4gIC8qKiByZXR1cm5zIHRoZSBhY3RpdmUgZmlsZSAqL1xuICBnZXRBY3RpdmVGaWxlKCkge1xuICAgIHJldHVybiB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlRmlsZSgpO1xuICB9XG5cbiAgLyoqIHJldHVybnMgdGhlIGRpcmVjdG9yeSBwYXRoIG9mIHRoZSBjdXJyZW50bHkgYWN0aXZlIGZpbGUgKi9cbiAgZ2V0QWN0aXZlRGlyZWN0b3J5UGF0aCgpIHtcbiAgICBjb25zdCBhY3RpdmVGaWxlID0gdGhpcy5nZXRBY3RpdmVGaWxlKCk7XG4gICAgaWYgKCFhY3RpdmVGaWxlKSByZXR1cm4gbnVsbFxuXG4gICAgY29uc3QgcmVzb3VyY2VQYXRoID0gdGhpcy5hcHAudmF1bHQuZ2V0UmVzb3VyY2VQYXRoKGFjdGl2ZUZpbGUpO1xuICAgIHJldHVybiByZXNvdXJjZVBhdGguc3Vic3RyaW5nKDAsIHJlc291cmNlUGF0aC5sYXN0SW5kZXhPZihcIi9cIikpO1xuICB9XG5cbiAgZ2V0VmF1bHRSb290UGF0aCgpIHtcbiAgICBjb25zdCByb290ID0gdGhpcy5hcHAudmF1bHQuZ2V0Um9vdCgpO1xuICAgIGNvbnN0IHJvb3RQYXRoID0gcm9vdC52YXVsdC5hZGFwdGVyLmdldFJlc291cmNlUGF0aCgnJyk7XG4gICAgcmV0dXJuIHJvb3RQYXRoLnN1YnN0cmluZygwLCByb290UGF0aC5sYXN0SW5kZXhPZignPycpKTtcbiAgfVxuICBnZXRJbWFnZXMoZWxlbWVudDogSFRNTEVsZW1lbnQpIHtcbiAgICByZXR1cm4gQXJyYXkuZnJvbShlbGVtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiaW1nXCIpKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0RWRpdG9yVmlld1BsdWdpbigpIHtcbiAgICBjb25zdCBwbHVnaW4gPSB0aGlzO1xuXG4gICAgcmV0dXJuIFZpZXdQbHVnaW4uZnJvbUNsYXNzKFxuICAgICAgY2xhc3MgRWRpdG9yVmlld1BsdWdpbiBpbXBsZW1lbnRzIFBsdWdpblZhbHVlIHtcblxuICAgICAgICBkZWJvdW5jZWRVcGRhdGUgPSBkZWJvdW5jZSgoY29udGVudDogSFRNTEVsZW1lbnQpID0+IHBsdWdpbi5tb2RpZnlJbWFnZXMoY29udGVudCkpO1xuXG4gICAgICAgIHVwZGF0ZSh1cGRhdGU6IFZpZXdVcGRhdGUpIHtcbiAgICAgICAgICB0aGlzLmRlYm91bmNlZFVwZGF0ZSh1cGRhdGUudmlldy5jb250ZW50RE9NKTtcbiAgICAgICAgfVxuXG4gICAgICB9XG4gICAgKVxuICB9XG59XG4iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQUEsMENBQUFBLFNBQUE7QUFLQSxJQUFBQSxRQUFPLFVBQVVDO0FBUWpCLFFBQUksc0JBQXNCO0FBRTFCLFFBQUksb0JBQW9CO0FBQ3hCLFFBQUksdUJBQXVCO0FBUzNCLGFBQVNBLE9BQU0sUUFBTztBQUNwQixVQUFJLE9BQU8sV0FBVyxVQUFVO0FBQzlCLGVBQU87QUFBQSxNQUNUO0FBRUEsVUFBSSxRQUFRLE9BQU8sTUFBTSxtQkFBbUI7QUFDNUMsVUFBSSxDQUFDLE9BQU87QUFDVixlQUFPO0FBQUEsTUFDVDtBQUVBLFVBQUksMEJBQTBCLE1BQU0sQ0FBQztBQUNyQyxVQUFJLENBQUMseUJBQXlCO0FBQzVCLGVBQU87QUFBQSxNQUNUO0FBRUEsVUFBSSxrQkFBa0IsS0FBSyx1QkFBdUIsS0FDOUMscUJBQXFC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
